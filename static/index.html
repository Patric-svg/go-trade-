<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoTrade Sentinel</title>
    <style>
        body { background-color: #0b0e11; color: #eaecef; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; }
        h2 { text-align: center; margin-bottom: 30px; }
        
        /* GRID LAYOUT FOR 6 CARDS */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .card {
            background-color: #1e2329;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            border-left: 5px solid #0ecb81; /* Default Green */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .symbol { font-size: 1.2rem; font-weight: bold; color: #848e9c; }
        .price { font-size: 1.5rem; font-family: 'Courier New', monospace; font-weight: 600; }
        .status-dot { height: 10px; width: 10px; background-color: #0ecb81; border-radius: 50%; display: inline-block; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <h2><span class="status-dot"></span> Market Watch (6 Pairs)</h2>
    
    <div class="dashboard-grid">
        <div class="card">
            <span class="symbol">BTC/USD</span>
            <span id="price-bitcoin" class="price">...</span>
        </div>
        <div class="card">
            <span class="symbol">ETH/USD</span>
            <span id="price-ethereum" class="price">...</span>
        </div>
        <div class="card">
            <span class="symbol">XRP/USD</span>
            <span id="price-ripple" class="price">...</span>
        </div>
        <div class="card">
            <span class="symbol">SOL/USD</span>
            <span id="price-solana" class="price">...</span>
        </div>
        <div class="card">
            <span class="symbol">ADA/USD</span>
            <span id="price-cardano" class="price">...</span>
        </div>
        <div class="card">
            <span class="symbol">DOGE/USD</span>
            <span id="price-dogecoin" class="price">...</span>
        </div>
    </div>

    <script>
        async function updatePrices() {
            try {
                const response = await fetch('/api/prices'); 
                
                // CHECK: Did the server report an error?
                if (!response.ok) {
                    throw new Error("Server Error");
                }

                const data = await response.json();

                // Helper to update text safely
                const setPrice = (id, val) => {
                    const el = document.getElementById(`price-${id}`);
                    el.innerText = "$" + val;
                    el.style.color = "#eaecef"; 
                };

                setPrice('bitcoin', data.bitcoin.usd);
                setPrice('ethereum', data.ethereum.usd);
                setPrice('ripple', data.ripple.usd);
                setPrice('solana', data.solana.usd);
                setPrice('cardano', data.cardano.usd);
                setPrice('dogecoin', data.dogecoin.usd);

                // Flash the status dot green to show we are live
                document.querySelector('.status-dot').style.backgroundColor = "#0ecb81";

            } catch (error) {
                console.error("Fetch failed:", error);
                
                // VISUAL ERROR HANDLING: Turn everything Red/Offline
                document.querySelector('.status-dot').style.backgroundColor = "#f6465d"; // Red Dot
                
                // Set all prices to "OFFLINE"
                const ids = ['bitcoin', 'ethereum', 'ripple', 'solana', 'cardano', 'dogecoin'];
                ids.forEach(id => {
                    const el = document.getElementById(`price-${id}`);
                    el.innerText = "OFFLINE";
                    el.style.color = "#f6465d"; // Red text
                });
            }
        }

        // Refresh every 5 seconds (increased from 3s to avoid hitting API limits)
        setInterval(updatePrices, 15000);
        updatePrices();
    </script>
</body>
</html>